// Fill out your copyright notice in the Description page of Project Settings.


#include "SH_PlayerAnim.h"
#include "SH_Player.h"
#include <GameFramework/CharacterMovementComponent.h>
#include "AttackComponent.h"
#include "IH_DieUI.h"

void USH_PlayerAnim::NativeBeginPlay()
{
	Super::NativeBeginPlay();
	APawn* pawn = TryGetPawnOwner();
	Player =  Cast<ASH_Player>(pawn);
}

void USH_PlayerAnim::NativeUpdateAnimation(float DeltaSeconds)
{
	Super::NativeUpdateAnimation(DeltaSeconds);

	if (Player != nullptr)
	{
		//이동 속도 가져오기
		FVector velocity = Player->GetVelocity();
		//전방 벡터 가져오기
		FVector forwardVector = Player->GetActorForwardVector();
		//두 벡터를 내적한 값을 dirV에 할당.
		dirV = FVector::DotProduct(forwardVector, velocity);

		//플레이어의 좌우방향 가져오기
		FVector rightVector = Player->GetActorRightVector();
		//두 벡터를 내적한 값을 dirH 할당
		dirH = FVector::DotProduct(rightVector, velocity);

		//공중에 있는지 여부 세팅
		bAir = Player->GetCharacterMovement()->IsFalling();
	}
}

void USH_PlayerAnim::AnimNotify_AttackEnd()
{
	Player->AttackComp->ResetAttack();
}

void USH_PlayerAnim::AnimNotify_NextCombo()
{
	Player->AttackComp->NextCombo();
}

void USH_PlayerAnim::AnimNotify_CommonAttack()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->CommonRange);
}

void USH_PlayerAnim::AnimNotify_IntensiveAttack1()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->IntensiveRange1);
}

void USH_PlayerAnim::AnimNotify_IntensiveAttack2()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->IntensiveRange2);
}

void USH_PlayerAnim::AnimNotify_SpecialAttack1()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->SpecialRange1);
}

void USH_PlayerAnim::AnimNotify_SpecialAttack2()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->SpecialRange2);
}

void USH_PlayerAnim::AnimNotify_DashEnd()
{
	Player->GetCharacterMovement()->DisableMovement();
}

void USH_PlayerAnim::AnimNotify_DashToWalk()
{
	Player->GetCharacterMovement()->SetMovementMode(MOVE_Walking);
}

void USH_PlayerAnim::AnimNotify_DamagedEnd()
{
	Player->AttackComp->ResetAttack();
}

void USH_PlayerAnim::AnimNotify_DieEnd()
{
	GetWorld()->GetFirstPlayerController()->bShowMouseCursor = true;
	Player->dieUI->AddToViewport();
}

void USH_PlayerAnim::AnimNotify_GS_CommonAttack()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->GS_CommonRange);
}

void USH_PlayerAnim::AnimNotify_GS_IntensiveAttack1()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->GS_IntensiveRange1);
}

void USH_PlayerAnim::AnimNotify_GS_IntensiveAttack2()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->GS_IntensiveRange2);
}

void USH_PlayerAnim::AnimNotify_GS_SpecialAttack1()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->GS_SpecialRange1);
}

void USH_PlayerAnim::AnimNotify_GS_SpecialAttack2()
{
	Player->AttackComp->TargetCheck(Player->AttackComp->GS_SpecialRange2);
}